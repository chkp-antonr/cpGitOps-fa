{% extends "test/layout.html" %}

{% block content %}
<p class="text-xl">Test view</p>
<p class="text-lg">Something.</p>
<p>AJAX test. </p>

  <hr class="my-2" />

<span id="send" class="button mx-3 w-44">Test WS update</span>
<button id="send" class="button mx-3 w-44" onclick="sendWSMessage('Button 1')">Send Message</button>
<button id="send" class="button mx-3 w-44" onclick="sendWSMessage('Button 2')">Send Message</button>

<pre class="text-xs text-gray">
    {{ content }}
  </pre>

<hr class="my-3" />

  <script>
    ws.onmessage = function (event) {
      const data = JSON.parse(event.data);
      // console.log(`${data} ${baseUrl} ${firstSubPath}`)
      // Check if status exists
      if (data.hasOwnProperty('ws_status')) {
        const statusDiv = document.getElementById('ws_status');
        if (data.ws_status.length === 0) {
          // console.log(`Empty ws_status.`)
          statusDiv.innerHTML = ""; // Clear previous status
          statusDiv.style.visibility = "hidden";
        } else {
          const formattedData = data.ws_status // .replace(/^"(.*)"$/, '$1');
          // console.log(formattedData)
          statusDiv.innerHTML = formattedData; // Clear previous status
          statusDiv.style.visibility = "visible";
        }
      }

      // Check if content exists
      if (data.hasOwnProperty('ws_content')) {
        const contentDiv = document.getElementById('ws_content');
        if (data.ws_content.length === 0) {
          // console.log(`Empty ws_content.`)
          contentDiv.innerHTML = ""; // Clear previous status
          // contentDiv.style.visibility = "hidden";
        } else {
          const formattedData = data.ws_content // .replace(/^"(.*)"$/, '$1');
          // console.log(formattedData)
          contentDiv.innerHTML += formattedData; // Clear previous status
          // contentDiv.style.visibility = "visible";
        }
      }

    }

    document.getElementById("send").onclick = function () {
      ws.send("Message from span!");
    }
  </script>

{% endblock content %}
