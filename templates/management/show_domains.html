{% extends "management/layout.html" %}

{% block content %}
  <p class="text-xl">Management view</p>
  <p class="text-lg">Show domains.</p>

  <hr class="my-2"/>
  <div class="">
    <div class="inline-block mr-2">
      <label for="mgmt_server" class="text-sm leading-none">Select Management server<br/>to refresh its domains:</label>
    </div>
    <select id="mgmt_server" class="px-2 py-1 mx-2 border-2 shadow-md inline-block">
      <option value="">Select server</option>
      {% for server in mgmt_servers %}
      <option value="{{ server }}"
        {% if mgmt_server %}selected{% endif %}>{{ server }}</option>
      {% endfor %}
    </select>
    <button name="update_ssot_dirs" class="button mx-3 w-44" title="Update SSoT directory structure from API"
      onclick="btn_click(`?mgmt_server=${document.getElementById('mgmt_server').value}&action=update_ssot_dirs`)">
      SSoT Dir update
    </button>
    <button name="fetch_api" class="button mx-3 w-44" title="Fetch objects and packages from API to CURRTEMP"
      onclick="btn_click(`?mgmt_server=${document.getElementById('mgmt_server').value}&action=fetch_api`)">
      Fetch from API
    </button>
  </div>

<script>
  // function btn_click(element, action) {
  //   const baseUrl = window.location.origin; // Get the base URL
  //   const selectedValue = document.getElementById("mgmt_server").value;
  //   if (selectedValue) {
  //     const newUrl = `${selectedValue}&action=${action}`;
  //     window.location.href = newUrl;
  //   }
  // };
  document.getElementById("mgmt_server").addEventListener('change', function () {
    const baseUrl = window.location.pathname; // Get the base URL
    const selectedValue = this.value;
    if (selectedValue) {
      const newUrl = `?mgmt_server=${selectedValue}`;
      window.location.href = newUrl;
    }
  });
</script>

  <hr class="my-2" />
  {{ content|safe }}
  <hr class="my-2" />

  {% if update_ssot_result.dirs_created %}
    <div class="my-2">
      <h3>Created directories:</h3>
      <ul class="font-mono">
        {% for item in update_ssot_result.dirs_created %}
          <li>{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if update_ssot_result.dirs_not_created %}
  <div class="my-2">
    <h3>Failed creating directories:</h3>
    <ul class="font-mono">
      {% for item in update_ssot_result.dirs_not_created %}
      <li>{{ item }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

{#
  <pre>
{{ content }}
  </pre>
#}
{% endblock content %}
